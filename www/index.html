<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <script src="javascripts/prototype.js" type="text/javascript" charset="utf-8"></script>
    <script src="javascripts/letters.js" type="text/javascript" charset="utf-8"></script>
    <script src="javascripts/plumb.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="stylesheets/screen.css" type="text/css" media="screen" charset="utf-8">
    <title>Plumb</title>
  </head>
  <body>
    
    <div id="header">
      <h1>||)) ||   || || ||~||~|| ||))
||   ||__ ||_|| || || || ||))</h1>

      <p>This is <b>Plumb</b>, a tool for composing web layouts for use with the <a href="http://blueprintcss.org">Blueprint CSS framework</a>.</p>
    </div>
    
    <div id="layout-help" class="help">
      <h4>How to use Plumb</h4>
      
      <p>Plumb works like a regular drawing program. This tool <img src="images/draw.gif" class="button-help"> is for drawing boxes. This tool <img src="images/select.gif" class="button-help"> is for selecting boxes and moving them around. To remove a box, select it and press the backspace key on your keyboard. You can shift-click boxes to select more than one at once.</p>
    </div>
    
    <div id="toolbar">
      <div class="group modes">
        <div class="select button"><img src="images/select.gif"></div>
        <div class="draw button"><img src="images/draw.gif"></div>
      </div>
    </div>
    
    <div id="layout">
    </div>
    
    <div id="recognize-help" class="help">
      <p>After you draw some boxes, click “Recognize &amp; test”. Plumb figures out how to construct your layout and generates a preview. You can click and drag the handles at the bottom of shapes to get a sense of your your layout will work with different content.</p>
    </div>
    
    <button id="recognize">Recognize &amp; test</button>
    
    <div id="preview" style="display:none;" class="clearfix"></div>
    
    <div id="html-help" class="help">
      <p>To get HTML code for your layout, click “Get HTML”. You’ll need to put it inside a webpage with the Blueprint stylesheets linked.</p>
    </div>
    
    <button id="code">Get HTML</button>
    
    <div id="code-output" style="display:none;"></div>
    
    <div id="debug-help" class="help">
      <p>If something doesn’t work the way you expect, let me know and I’ll try to fix it. To make it easier to fix the problem, click “Get debugging info” and send me the result with a description of what’s going on. My email address is <a href="mailto:michael@mdaines.com">michael@mdaines.com</a>.</p>
    </div>
    
    <button id="debug">Get debugging info</button>
    
    <div id="debug-output" style="display:none;"></div>
    
    <script type="text/javascript" charset="utf-8">
      
      Plumb.setup({
        layout: { element: "layout", width: 24 },
        toolbar: { element: "toolbar" },
        column: { width: 30, margin: 10 },
        shape: { border: 1 }
      });
      
      var LayoutTest = {
        start: function(event) {
          this.handle = event.findElement(".handle");
          
          if (this.handle) {
            this.measurements = {
              pointer: event.pointer(),
              height: this.handle.up(".box").offsetHeight
            }
            this.dragging = true;
            
            event.stop();
          }
        },
        
        drag: function(event) {
          if (this.dragging) {
            var dim = this.measurements.height - (this.measurements.pointer.y - event.pointer().y);
            if (dim < 25) dim = 25;
            
            this.handle.up(".box").setStyle({ height: dim + "px" });
            
            event.stop();
          }
        },
        
        finish: function(event) {
          this.dragging = false;
        }
      }
      
      $("preview").observe("mousedown", function(e) { LayoutTest.start(e); });
      Event.observe(window, "mousemove", function(e) { LayoutTest.drag(e); });
      Event.observe(window, "mouseup", function(e) { LayoutTest.finish(e); });
      
      $("recognize").observe("click", function() {
        try {
          var spec = Plumb.Recognition.recognize();
          
          $("preview").immediateDescendants().invoke("remove");
          
          var inner = new Element("div", { className: "inner" });
          $("preview").insert(inner);
          
          Plumb.Output.output(spec, inner);
          
          $("preview").select(".column").each(function(col) {
            col.insert( new Element("div", { className: "box" }).setStyle({ height: col.getStyle("height") }));
            col.setStyle({ height: null });
          });
          
          $("preview").select(".box").each(function(box) {
            box.insert( new Element("div", { className: "handle" }) );
          });
          
          $("preview").show();
          
        } catch (e) {
          if (e == Plumb.UnsupportedLayout) {
            alert("Sorry, Plumb can't recognize layouts like that.");
          } else {
            throw e;
          }
        }
      });
      
      $("debug").observe("click", function() {
        try {
          $("debug-output").innerHTML = Object.toJSON(Plumb.Recognition.getShapes()).escapeHTML();
          
          $("debug-output").show();
          
        } catch (e) {
          if (e == Plumb.UnsupportedLayout) {
            alert("Sorry, Plumb can't recognize layouts like that.");
          } else {
            throw e;
          }
        }
      });
      
      $("code").observe("click", function() {
        try {
          var container = new Element("div");
          Plumb.Output.output(Plumb.Recognition.recognize(), container);
          
          var html = "";
          
          function outputChildren(element, level) {
            if (Object.isUndefined(level))
              level = 0;
            
            element.immediateDescendants().each(function(child) {
              html += "&nbsp;&nbsp;".times(level) + "&lt;div class=&quot;" + child.className + "&quot;&gt;<br>";
              
              if (child.hasClassName("column"))
                html += "&nbsp;&nbsp;".times(level + 1) + "Lorem ipsum dolor<br>";
              else
                outputChildren(child, level + 1);
              
              html += "&nbsp;&nbsp;".times(level) + "&lt;/div&gt;<br>";
            });
          }
          
          outputChildren(container);
          
          $("code-output").innerHTML = html;
          $("code-output").show();
          
        } catch (e) {
          if (e == Plumb.UnsupportedLayout) {
            alert("Sorry, Plumb can't recognize layouts like that.");
          } else {
            throw e;
          }
        }
      });
      
    </script>
    
    <div id="footer">
      <p>Plumb was made by <a href="http://mdaines.com">Michael Daines</a>. The code is hosted at <a href="http://github.com/mdaines/plumb/tree/blueprint">Github</a>.</p>
    </div>
    
  </body>
</html>