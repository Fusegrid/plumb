<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="test.css" type="text/css" media="screen" charset="utf-8">
    <script src="../lib/prototype.js" type="text/javascript" charset="utf-8"></script>
    <script src="../lib/unittest.js" type="text/javascript" charset="utf-8"></script>
    <script src="../src/code_output.js" type="text/javascript" charset="utf-8"></script>
    <script src="../src/letter_identification.js" type="text/javascript" charset="utf-8"></script>
  </head>
  <body>
    
    <div id="testlog">
    </div>
    
    <script type="text/javascript" charset="utf-8">
    
      var Columns = {
        marginWidth: 10,
        columnWidth: 10,
        columnCount: 5,
        totalWidth: 90
      };
      
      Fixtures = {
        justTwoRows: {
          type: "rows",
          left: 0,
          right: 90,
          children: [
            { id: "a", left: 0, right: 90 },
            { id: "b", left: 0, right: 90 }
          ]
        },
        
        justTwoColumns: {
          type: "columns",
          left: 0,
          right: 90,
          children: [
            { id: "a", left: 0, right: 10 },
            { id: "b", left: 20, right: 90 }
          ]
        },
        
        twoRowsWithColumns: {
          type: "rows",
          left: 0,
          right: 90,
          children: [
            {
              type: "columns",
              left: 0,
              right: 90,
              children: [
                { id: "a", left: 0, right: 10 },
                { id: "b", left: 20, right: 30 },
                { id: "c", left: 40, right: 90 }
              ]
            },
            { id: "d", left: 0, right: 90 }
          ]
        },
        
        requiresNesting: {
          type: "columns",
          left: 0,
          right: 90,
          children: [
            { id: "a", left: 0, right: 10 },
            {
              type: "rows",
              left: 20,
              right: 90,
              children: [
                { id: "b", left: 20, right: 90 },
                {
                  type: "columns",
                  left: 20,
                  right: 90,
                  children: [
                    { id: "c", left: 20, right: 30 },
                    { id: "d", left: 40, right: 90 }
                  ]
                }
              ]
            }
          ] 
        },
        
        anotherRequiresNesting: {
          type: "rows",
          left: 0,
          right: 90,
          children: [
            { id: "a", left: 0, right: 90 },
            {
              type: "columns",
              left: 0,
              right: 90,
              children: [
                { id: "b", left: 0, right: 10 },
                {
                  type: "rows",
                  left: 20,
                  right: 90,
                  children: [
                    { id: "c", left: 20, right: 90 },
                    { id: "d", left: 20, right: 90 }
                  ]
                }
              ]
            }
          ] 
        },
        
        reallyDeepNesting: {
          type: "columns",
          left: 0,
          right: 90,
          children: [
            { id: "a", left: 0, right: 10 },
            {
              type: "rows",
              left: 20,
              right: 90,
              children: [
                { id: "b", left: 20, right: 90 },
                {
                  type: "columns",
                  left: 20,
                  right: 90,
                  children: [
                    { id: "c", left: 20, right: 30 },
                    {
                      type: "rows",
                      left: 40,
                      right: 90,
                      children: [
                        { id: "d", left: 40, right: 90 },
                        {
                          type: "columns",
                          left: 40,
                          right: 90,
                          children: [
                            { id: "e", left: 40, right: 50 },
                            {
                              type: "rows",
                              left: 60,
                              right: 90,
                              children: [
                                { id: "f", left: 60, right: 90 },
                                {
                                  type: "columns",
                                  left: 60,
                                  right: 90,
                                  children: [
                                    { id: "g", left: 60, right: 70 },
                                    { id: "h", left: 80, right: 90 }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        
        lessDeepNesting: {
          type: "columns",
          left: 0,
          right: 90,
          children: [
            { id: "a", left: 0, right: 10 },
            {
              type: "rows",
              left: 20,
              right: 90,
              children: [
                { id: "b", left: 20, right: 90 },
                {
                  type: "columns",
                  left: 20,
                  right: 90,
                  children: [
                    { id: "c", left: 20, right: 30 },
                    {
                      type: "rows",
                      left: 40,
                      right: 70,
                      children: [
                        { id: "d", left: 40, right: 70 },
                        {
                          type: "columns",
                          left: 40,
                          right: 70,
                          children: [
                            { id: "e", left: 40, right: 50 },
                            { id: "f", left: 60, right: 70 }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        
        needsPrepending: {
          type: "columns",
          left: 0,
          right: 90,
          children: [
            { id: "a", left: 20, right: 30 },
            { id: "b", left: 40, right: 50 },
            { id: "c", left: 80, right: 90 }
          ]
        },
        
        needsPrependingAndAppending: {
          type: "columns",
          left: 0,
          right: 90,
          children: [
            { id: "a", left: 20, right: 30 },
            { id: "b", left: 40, right: 50 }
          ]
        },
        
        rowsWithPrependingAndAppending: {
          type: "rows",
          left: 0,
          right: 90,
          children: [
            { id: "a", left: 20, right: 30 },
            { id: "b", left: 40, right: 50 },
            { id: "c", left: 0, right: 90 },
            { id: "d", left: 0, right: 90 },
            { id: "e", left: 0, right: 70 }
          ]
        },
        
        prepedingAndAppendingWithNesting: {
          type: "columns",
          left: 0,
          right: 90,
          width: 90,
          children: [
            { id: "a", left: 0, right: 10 },
            {
              type: "rows",
              left: 20,
              right: 90,
              children: [
                { id: "b", left: 20, right: 70 },
                {
                  type: "columns",
                  left: 20,
                  right: 90,
                  children: [
                    { id: "c", left: 20, right: 30 },
                    { id: "d", left: 60, right: 90 }
                  ]
                }
              ]
            }
          ] 
        },
        
        notWholeWidth: {
          type: "rows",
          left: 0,
          right: 90,
          children: [
            {
              type: "columns",
              left: 20,
              right: 70,
              children: [
                { id: "a", left: 20, right: 30 },
                { id: "b", left: 60, right: 70 }
              ]
            },
            { id: "c", left: 40, right: 50 }
          ]
        },
        
        justOnePrependedAndAppended: {
          type: "rows",
          left: 0,
          right: 90,
          children: [
            { id: "a", left: 20, right: 30 }
          ]
        }
      };
      
      Test.context("CodeOutput", {
        "should give us the right structure for HTML": function() {
          var elements;
          
          elements = BlueprintGeneration.elementsForContainer(Fixtures.justTwoRows);
          elements[0].id.shouldEqual("a");
          elements[1].id.shouldEqual("b");
          
          elements = BlueprintGeneration.elementsForContainer(Fixtures.justTwoColumns);
          elements[0].id.shouldEqual("a");
          elements[1].id.shouldEqual("b");
          
          elements = BlueprintGeneration.elementsForContainer(Fixtures.twoRowsWithColumns);
          elements[0].id.shouldEqual("a");
          elements[1].id.shouldEqual("b");
          elements[2].id.shouldEqual("c");
          elements[3].id.shouldEqual("d");
        },
        
        "should give us the right structure when we need nesting": function() {
          var elements;
          
          elements = BlueprintGeneration.elementsForContainer(Fixtures.requiresNesting);
          elements[0].id.shouldEqual("a");
          elements[1].children[0].id.shouldEqual("b");
          elements[1].children[1].id.shouldEqual("c");
          elements[1].children[2].id.shouldEqual("d");
          
          elements = BlueprintGeneration.elementsForContainer(Fixtures.anotherRequiresNesting);
          elements[0].id.shouldEqual("a");
          elements[1].id.shouldEqual("b");
          elements[2].children[0].id.shouldEqual("c");
          elements[2].children[1].id.shouldEqual("d");
        },
        
        "should prepend": function() {
          var elements = BlueprintGeneration.elementsForContainer(Fixtures.needsPrepending);
          
          elements[0].prepend.shouldEqual(20);
          elements[1].prepend.shouldEqual(0);
          elements[2].prepend.shouldEqual(20);
        },
        
        "should prepend and append": function() {
          var elements = BlueprintGeneration.elementsForContainer(Fixtures.needsPrependingAndAppending);
          
          elements[0].prepend.shouldEqual(20);
          elements[0].append.shouldEqual(0);
          elements[1].prepend.shouldEqual(0);
          elements[1].append.shouldEqual(40);
        },
        
        "prepending and appending should work with rows": function() {
          var elements = BlueprintGeneration.elementsForContainer(Fixtures.rowsWithPrependingAndAppending);
          
          elements[0].prepend.shouldEqual(20);
          elements[0].append.shouldEqual(60);
          
          elements[1].prepend.shouldEqual(40);
          elements[1].append.shouldEqual(40);
          
          elements[2].prepend.shouldEqual(0);
          elements[2].append.shouldEqual(0);
          
          elements[3].prepend.shouldEqual(0);
          elements[3].append.shouldEqual(0);
          
          elements[4].prepend.shouldEqual(0);
          elements[4].append.shouldEqual(20);
        },
        
        "prepending and appending should work with nested containers": function() {
          var elements = BlueprintGeneration.elementsForContainer(Fixtures.prepedingAndAppendingWithNesting);
          
          elements[0].prepend.shouldEqual(0);
          elements[0].append.shouldEqual(0);
          
          elements[1].children[0].prepend.shouldEqual(0);
          elements[1].children[0].append.shouldEqual(20);
          
          elements[1].children[1].prepend.shouldEqual(0);
          elements[1].children[1].append.shouldEqual(0);
          
          elements[1].children[2].prepend.shouldEqual(20);
          elements[1].children[2].append.shouldEqual(0);
        },
        
        "more prepending and appending": function() {
          var elements = BlueprintGeneration.elementsForContainer(Fixtures.notWholeWidth);
          
          elements[0].prepend.shouldEqual(20);
          elements[0].append.shouldEqual(0);
          
          elements[1].prepend.shouldEqual(20);
          elements[1].append.shouldEqual(20);
          
          elements[2].prepend.shouldEqual(40);
          elements[2].append.shouldEqual(40);
        },
        
        "prepending and appending with a single element": function() {
          var elements = BlueprintGeneration.elementsForContainer(Fixtures.justOnePrependedAndAppended);
          
          elements[0].prepend.shouldEqual(20);
          elements[0].append.shouldEqual(60);
        },
        
        "more prepending and appending for deeply nested containers with appended space": function() {
          var elements = BlueprintGeneration.elementsForContainer(Fixtures.lessDeepNesting);
          
          elements[1].prepend.shouldEqual(0);
          elements[1].append.shouldEqual(0);
          
          elements[1].children[2].prepend.shouldEqual(0);
          elements[1].children[2].append.shouldEqual(20);
          
          elements[1].children[2].children[2].prepend.shouldEqual(0);
          elements[1].children[2].children[2].append.shouldEqual(0);
        }
      });
      
    </script>
    
  </body>
</html>