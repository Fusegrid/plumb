<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="test.css" type="text/css" media="screen" charset="utf-8">
    <script src="../lib/prototype.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/unittest.js" type="text/javascript" charset="utf-8"></script>
    <script src="../src/plumb.js" type="text/javascript" charset="utf-8"></script>
    <script src="../src/layout.js" type="text/javascript" charset="utf-8"></script>
    <script src="../src/column.js" type="text/javascript" charset="utf-8"></script>
    <script src="../src/recognition.js" type="text/javascript" charset="utf-8"></script>
  </head>
  <body>
    
    <div id="testlog">
    </div>
    
    <script type="text/javascript" charset="utf-8">
    
      Plumb.setup({
        layout: { element: new Element('div') }
      });
      
      Object.extend(Test.Unit.Testcase.prototype, {
        assertSpacing: function(expected, shapes) {
          var container = Plumb.Recognition.buildContainer(shapes);
          var spacing = $H();
          expected = $H(expected);
          
          (function(c) {
            if (c.children) {
              var ids = c.children.map(arguments.callee).join("");
              spacing.set(ids, [c.prepend, c.append]);
              return ids;
            } else {
              spacing.set(c.id, [c.prepend, c.append]);
              return c.id;
            }
          })(container);
          
          var message = this.buildMessage('assertSpacing', '<?> was not the same as <?>', expected, spacing);
          var block = function() {
            return expected.keys().length == spacing.keys().length &&
                    spacing.all(function(p) {
                      return expected.get(p.key)[0] == p.value[0] && expected.get(p.key)[1] == p.value[1];
                    });
          };
          
          this.assertBlock(message, block);
        }
      });
      
      var Fixtures = {
        //      |--a--|
        rootWithPrependAndAppend: [
          { id: "a", left: 1, right: 10, top: 10, bottom: 90, width: 10 }
        ],
        
        // |------a------|
        //
        //         |--b--|
        headerAndPrependedRow: [
          { id: "a", left: 0, right: 11, top: 10, bottom: 90, width: 12 },
          { id: "b", left: 6, right: 11, top: 100, bottom: 190, width: 6 }
        ],
        
        // |------a------|
        //
        // |--b--|
        headerAndAppendedRow: [
          { id: "a", left: 0, right: 11, top: 10, bottom: 90, width: 12 },
          { id: "b", left: 0, right: 5, top: 100, bottom: 190, width: 6 }
        ],
        
        // |----------a----------|
        //
        // |--b--|         |--c--|
        headerAndAppendedColumn: [
          { id: "a", left: 0, right: 11, top: 10, bottom: 90, width: 12 },
          { id: "b", left: 0, right: 3, top: 100, bottom: 190, width: 4 },
          { id: "c", left: 8, right: 11, top: 100, bottom: 190, width: 4 }
        ],
        
        // |----------a----------|         |------d------|
        //                                 |-------------|
        // |--b--|         |--c--|         |-------------|
        //
        // |------------------e--------------------------|
        //
        //                 |--f--|
        moreComplicated: [
          { id: "a", left: 0, right: 5, top: 0, bottom: 10, width: 6 },
          { id: "b", left: 0, right: 1, top: 20, bottom: 30, width: 2 },
          { id: "c", left: 4, right: 5, top: 20, bottom: 30, width: 2 },
          { id: "d", left: 8, right: 11, top: 0, bottom: 30, width: 4 },
          { id: "e", left: 0, right: 11, top: 40, bottom: 50, width: 12 },
          { id: "f", left: 4, right: 5, top: 60, bottom: 70, width: 2 }
        ]
      }
      
      new Test.Unit.Runner({
        testRoot: function() { with(this) {
          assertSpacing({ a: [1,1] }, Fixtures.rootWithPrependAndAppend);
        }},
        
        testHeaderAndRow: function() { with(this) {
          assertSpacing({ ab: [0,0], a: [0,0], b: [6,0] }, Fixtures.headerAndPrependedRow);
          assertSpacing({ ab: [0,0], a: [0,0], b: [0,6] }, Fixtures.headerAndAppendedRow);
        }},
        
        testAppendedColumn: function() { with(this) {
          assertSpacing({ abc: [0,0], a: [0,0], bc: [0,0], b: [0,0], c: [4,0] }, Fixtures.headerAndAppendedColumn);
        }},
        
        testMoreComplicated: function() { with(this) {
          assertSpacing({ abcdef: [0,0], abcd: [0,0], abc: [0,0], bc: [0,0], d: [2,0], a: [0,0], b: [0,0], c: [2,0], e: [0,0], f: [4,6] }, Fixtures.moreComplicated);
        }}
      });
      
    </script>
    
  </body>
</html>