<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>stretch_function</title>
    <script src="lib/prototype.js" type="text/javascript" charset="utf-8"></script>
    <style type="text/css" media="screen">
      
      #stage .container {
        float: left;
        width: 100%;
        background: #f00;
        padding-top: 10px;
        margin-bottom: 10px;
      }
      
      #stage .box {
        height: 50px;
        margin-bottom: 10px;
        background: #ccc;
      }
      
      #stage .space {
        height: 50px;
        margin-bottom: 10px;
        background: #f33;
      }
      
    </style>
  </head>
  <body>
    
    <div id="stage">
    </div>
    
    <script type="text/javascript" charset="utf-8">
    
      COLUMN = 100;
      MARGIN = 10;
      
      var sss = function(spec) {
        var container = new Element("div", { "class": "container" });
        
        var fixedSpace = spec.inject(0, function(s, b) {
          s += Object.isNumber(b.width) ? (COLUMN * b.width) + (MARGIN * (b.width - 1)) : 0;
          return s;
        }) + ((spec.length + 1) * MARGIN);
        
        var usedFixedSpace = 0;
        var stretchy = []
        
        var emitStretchy = function() {
          stretchy.each(function(box) {
            var element = new Element("div", { "class": "box" });
            var wrap = new Element("div");
          
            element.setStyle({
              "float": "left",
              "width": box.width.percentage + "%"
            });
          
            wrap.setStyle({
              "marginLeft": (usedFixedSpace + MARGIN) + "px",
              "marginRight": (fixedSpace - (usedFixedSpace + MARGIN)) + "px"
            });
          
            wrap.insert(element);
            container.insert(wrap);
          
            usedFixedSpace += MARGIN;
          });
          
          stretchy = [];
        }
        
        spec.each(function(box) {
          if (Object.isNumber(box.width)) {
            if (stretchy.length > 0)
              emitStretchy();
            
            var element = new Element("div", { "class": "box" });
            
            width = (COLUMN * box.width) + (MARGIN * (box.width - 1))
            
            element.setStyle({
              "float": "left",
              "width": width + "px",
              "marginLeft": MARGIN + "px"
            });
            
            container.insert(element);
            
            usedFixedSpace += width + MARGIN;
          } else {
            stretchy.push(box);
          }
        });
        
        if (stretchy.length > 0)
          emitStretchy();
        
        $("stage").insert(container);
      }
      
      
      // sss([
      //   { width: 1 },
      //   { width: { percentage: 25, subtrahend: 3 } },
      //   { width: { percentage: 25, subtrahend: 3 } },
      //   { width: 1 },
      //   { width: { percentage: 25, subtrahend: 3 } },
      //   { width: { percentage: 25, subtrahend: 3 } },
      //   { width: 1 }
      // ]);
      // 
      // sss([
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 5 } },
      //   { width: 1 },
      //   { width: 1 },
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 5 } },
      //   { width: 1 }
      // ]);
      // 
      // sss([
      //   { width: { percentage: 25, subtrahend: 2 } },
      //   { width: { percentage: 25, subtrahend: 2 } },
      //   { width: 1 },
      //   { width: { percentage: 25, subtrahend: 2 } },
      //   { width: { percentage: 25, subtrahend: 2 } },
      //   { width: 1 }
      // ]);
      // 
      // sss([
      //   { width: 1 },
      //   { width: { percentage: 25, subtrahend: 2 } },
      //   { width: 1 },
      //   { width: { percentage: 75, subtrahend: 2 } }
      // ]);
      // 
      // sss([
      //   { width: 1 },
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 5 } },
      //   { width: 1 },
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 5 } },
      //   { width: 1 }
      // ]);
      // 
      // sss([
      //   { width: 1 },
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 4 } },
      //   { width: 1 },
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 4 } }
      // ]);
      // 
      // sss([
      //   { width: 1 },
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 3 } },
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 3 } }
      // ]);
      // 
      // sss([
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 2 } },
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 2 } }
      // ]);
      // 
      // sss([
      //   { width: 1 },
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 2 } },
      //   { width: { percentage: 50, subtrahend: 2 } }
      // ]);
      // 
      // sss([
      //   { width: 1 },
      //   { width: { percentage: 50, subtrahend: 1 } },
      //   { width: { percentage: 50, subtrahend: 1 } }
      // ]);
      
      sss([
        { width: { percentage: 50, subtrahend: 0 } },
        { width: { percentage: 50, subtrahend: 0 } }
      ]);
      
      sss([
        { width: { percentage: 100, subtrahend: 2 } },
        { width: 1 },
        { width: 1 }
      ]);
      
      sss([
        { width: 1 },
        { width: { percentage: 100, subtrahend: 2 } },
        { width: 1 }
      ]);
      
      sss([
        { width: 1 },
        { width: 1 },
        { width: { percentage: 100, subtrahend: 2 } }
      ]);
      
      sss([
        { width: 2 },
        { width: { percentage: 100, subtrahend: 2 } }
      ]);
      
      sss([
        { width: 1 },
        { width: { percentage: 100, subtrahend: 1 } }
      ]);
      
      sss([
        { width: { percentage: 100, subtrahend: 1 } },
        { width: 1 }
      ]);
      
      sss([
        { width: { percentage: 100, subtrahend: 0 } }
      ]);
      
    </script>
    
  </body>
</html>